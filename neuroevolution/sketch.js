let person;
let boundary;
let creatures = []

const Render = Matter.Render
const engine = Matter.Engine.create();
const world = engine.world;
let generation = new Generation(20);
let settled = false;

console.log('handleByTicker')

const tickerHistory = [{"datetime":"2018-03-09","ticker":"VALE3","open":40.97,"close":42.1,"high":42.27,"low":40.51,"volume":878310594},{"datetime":"2018-03-12","ticker":"VALE3","open":42.29,"close":42.46,"high":42.63,"low":41.94,"volume":501437606},{"datetime":"2018-03-13","ticker":"VALE3","open":42.74,"close":42.13,"high":42.8,"low":42.05,"volume":585838406},{"datetime":"2018-03-14","ticker":"VALE3","open":42.85,"close":42.6,"high":43.34,"low":42.57,"volume":769953477},{"datetime":"2018-03-15","ticker":"VALE3","open":42.7,"close":42.4,"high":42.82,"low":42.13,"volume":679867937},{"datetime":"2018-03-16","ticker":"VALE3","open":42.4,"close":42.3,"high":42.6,"low":42.05,"volume":1134269107},{"datetime":"2018-03-19","ticker":"VALE3","open":41.52,"close":41.1,"high":41.52,"low":40.67,"volume":897720575},{"datetime":"2018-03-20","ticker":"VALE3","open":41.1,"close":41.6,"high":41.92,"low":40.93,"volume":386478030},{"datetime":"2018-03-21","ticker":"VALE3","open":41.75,"close":42.5,"high":42.69,"low":41.43,"volume":837737485},{"datetime":"2018-03-22","ticker":"VALE3","open":41.94,"close":41.93,"high":42.25,"low":41.62,"volume":639094288},{"datetime":"2018-03-23","ticker":"VALE3","open":41.24,"close":41.6,"high":42.2,"low":41.01,"volume":625766259},{"datetime":"2018-03-26","ticker":"VALE3","open":42,"close":42,"high":42.38,"low":41.61,"volume":413552169},{"datetime":"2018-03-27","ticker":"VALE3","open":42.39,"close":40.86,"high":42.39,"low":40.72,"volume":482448721},{"datetime":"2018-03-28","ticker":"VALE3","open":40.61,"close":41.54,"high":41.7,"low":40.06,"volume":776718668},{"datetime":"2018-03-29","ticker":"VALE3","open":41.87,"close":42.21,"high":42.75,"low":41.74,"volume":863080847},{"datetime":"2018-04-02","ticker":"VALE3","open":42.32,"close":43,"high":43.47,"low":42.32,"volume":814485403},{"datetime":"2018-04-03","ticker":"VALE3","open":43.4,"close":42.87,"high":43.55,"low":42.44,"volume":587557318},{"datetime":"2018-04-04","ticker":"VALE3","open":41.8,"close":42.55,"high":42.6,"low":41.59,"volume":523747259},{"datetime":"2018-04-05","ticker":"VALE3","open":43.31,"close":43.25,"high":43.69,"low":43.03,"volume":636997098},{"datetime":"2018-04-06","ticker":"VALE3","open":42.91,"close":42.74,"high":43.1,"low":42.25,"volume":481300369},{"datetime":"2018-04-09","ticker":"VALE3","open":43.07,"close":42.95,"high":43.23,"low":42.21,"volume":510109910},{"datetime":"2018-04-10","ticker":"VALE3","open":43.8,"close":44.84,"high":44.84,"low":43.67,"volume":996943545},{"datetime":"2018-04-11","ticker":"VALE3","open":44.56,"close":44.64,"high":45.06,"low":44.22,"volume":790325396},{"datetime":"2018-04-12","ticker":"VALE3","open":44.42,"close":44.81,"high":44.86,"low":44.32,"volume":438401965},{"datetime":"2018-04-13","ticker":"VALE3","open":44.85,"close":44.98,"high":45.17,"low":44.6,"volume":695768916},{"datetime":"2018-04-16","ticker":"VALE3","open":44.61,"close":44.54,"high":44.85,"low":44.31,"volume":509086602},{"datetime":"2018-04-17","ticker":"VALE3","open":44.6,"close":45.93,"high":46,"low":44.56,"volume":608329673},{"datetime":"2018-04-18","ticker":"VALE3","open":47,"close":47.48,"high":48.08,"low":46.85,"volume":1314779859},{"datetime":"2018-04-19","ticker":"VALE3","open":47.78,"close":47.83,"high":48.17,"low":47.4,"volume":769909692},{"datetime":"2018-04-20","ticker":"VALE3","open":47.76,"close":47.63,"high":47.9,"low":47.33,"volume":484911445},{"datetime":"2018-04-23","ticker":"VALE3","open":47.22,"close":47.5,"high":47.98,"low":47.06,"volume":559598090},{"datetime":"2018-04-24","ticker":"VALE3","open":47.7,"close":48.31,"high":48.59,"low":47.7,"volume":729069687},{"datetime":"2018-04-25","ticker":"VALE3","open":47.75,"close":47.95,"high":48.49,"low":47.44,"volume":744660025},{"datetime":"2018-04-26","ticker":"VALE3","open":47.7,"close":48.7,"high":49,"low":47.62,"volume":642413154},{"datetime":"2018-04-27","ticker":"VALE3","open":48.9,"close":48.35,"high":49.15,"low":47.86,"volume":707278340},{"datetime":"2018-04-30","ticker":"VALE3","open":48.26,"close":48.67,"high":48.83,"low":48.15,"volume":411200143},{"datetime":"2018-05-02","ticker":"VALE3","open":48.5,"close":48.71,"high":49.32,"low":48.42,"volume":808649926},{"datetime":"2018-05-03","ticker":"VALE3","open":48.81,"close":49.09,"high":49.33,"low":48.58,"volume":687272416},{"datetime":"2018-05-04","ticker":"VALE3","open":48.92,"close":49.7,"high":49.9,"low":48.92,"volume":735919038},{"datetime":"2018-05-07","ticker":"VALE3","open":49.72,"close":49.24,"high":50.04,"low":49.11,"volume":763120433},{"datetime":"2018-05-08","ticker":"VALE3","open":49.25,"close":49.19,"high":49.68,"low":48.91,"volume":1105091891},{"datetime":"2018-05-09","ticker":"VALE3","open":49.42,"close":50.25,"high":50.42,"low":49.33,"volume":837211350},{"datetime":"2018-05-10","ticker":"VALE3","open":50.41,"close":51.4,"high":51.4,"low":50.38,"volume":730150330},{"datetime":"2018-05-11","ticker":"VALE3","open":51.77,"close":52.63,"high":53.58,"low":51.75,"volume":1128746163},{"datetime":"2018-05-14","ticker":"VALE3","open":53.08,"close":54.27,"high":54.4,"low":53,"volume":853976090},{"datetime":"2018-05-15","ticker":"VALE3","open":53.81,"close":54.65,"high":54.65,"low":53.18,"volume":861967139},{"datetime":"2018-05-16","ticker":"VALE3","open":55.33,"close":55.9,"high":56,"low":55.14,"volume":1166371189},{"datetime":"2018-05-17","ticker":"VALE3","open":55.3,"close":55.38,"high":55.8,"low":54.75,"volume":1119792152},{"datetime":"2018-05-18","ticker":"VALE3","open":54.7,"close":54.77,"high":55.5,"low":53.45,"volume":1218234675},{"datetime":"2018-05-21","ticker":"VALE3","open":55.01,"close":53,"high":55.1,"low":53,"volume":1214405305},{"datetime":"2018-05-22","ticker":"VALE3","open":52.87,"close":52.34,"high":53.06,"low":51.87,"volume":1073668131},{"datetime":"2018-05-23","ticker":"VALE3","open":51.8,"close":51.94,"high":52.24,"low":51.25,"volume":812282943},{"datetime":"2018-05-24","ticker":"VALE3","open":51.32,"close":52.46,"high":53,"low":51.26,"volume":759303397},{"datetime":"2018-05-25","ticker":"VALE3","open":52.58,"close":51.48,"high":52.79,"low":51.05,"volume":677238430},{"datetime":"2018-05-28","ticker":"VALE3","open":50.9,"close":51.07,"high":52.46,"low":50.71,"volume":712076875},{"datetime":"2018-05-29","ticker":"VALE3","open":51.97,"close":50.16,"high":52.06,"low":49.99,"volume":949149179},{"datetime":"2018-05-30","ticker":"VALE3","open":50.21,"close":50.63,"high":51.35,"low":49.7,"volume":1308263384},{"datetime":"2018-06-01","ticker":"VALE3","open":50.9,"close":52.76,"high":53.08,"low":50.65,"volume":1057721434},{"datetime":"2018-06-04","ticker":"VALE3","open":53.18,"close":52.52,"high":53.45,"low":51.76,"volume":731255250},{"datetime":"2018-06-05","ticker":"VALE3","open":52.5,"close":53.73,"high":54,"low":52.5,"volume":910379447},{"datetime":"2018-06-06","ticker":"VALE3","open":54.5,"close":56.07,"high":56.23,"low":54.49,"volume":1488610257},{"datetime":"2018-06-07","ticker":"VALE3","open":56.46,"close":54.37,"high":56.75,"low":53.07,"volume":1765464144},{"datetime":"2018-06-08","ticker":"VALE3","open":53.99,"close":50.89,"high":53.99,"low":50.66,"volume":1569106399},{"datetime":"2018-06-11","ticker":"VALE3","open":51.37,"close":50.85,"high":52,"low":50.59,"volume":735021139},{"datetime":"2018-06-12","ticker":"VALE3","open":50.5,"close":51.7,"high":52.36,"low":50.16,"volume":951252478},{"datetime":"2018-06-13","ticker":"VALE3","open":51.98,"close":51.55,"high":52.24,"low":50.73,"volume":801464247},{"datetime":"2018-06-14","ticker":"VALE3","open":51.87,"close":51.71,"high":51.89,"low":50.75,"volume":967193446},{"datetime":"2018-06-15","ticker":"VALE3","open":51.4,"close":49.13,"high":51.44,"low":48.7,"volume":1812084563},{"datetime":"2018-06-18","ticker":"VALE3","open":48.62,"close":49.21,"high":49.29,"low":47.86,"volume":999738290},{"datetime":"2018-06-19","ticker":"VALE3","open":47.7,"close":48.3,"high":48.75,"low":47.03,"volume":1282584425},{"datetime":"2018-06-20","ticker":"VALE3","open":49.05,"close":48.81,"high":49.08,"low":48.07,"volume":702334717},{"datetime":"2018-06-21","ticker":"VALE3","open":48.51,"close":47.21,"high":49.2,"low":47.04,"volume":665696911},{"datetime":"2018-06-22","ticker":"VALE3","open":48.15,"close":48.01,"high":48.47,"low":47.48,"volume":462038264},{"datetime":"2018-06-25","ticker":"VALE3","open":47.7,"close":47.16,"high":47.8,"low":46.26,"volume":647096058},{"datetime":"2018-06-26","ticker":"VALE3","open":47.5,"close":48.34,"high":48.34,"low":46.63,"volume":736189190},{"datetime":"2018-06-27","ticker":"VALE3","open":48.48,"close":48.15,"high":49.28,"low":47.9,"volume":701821566},{"datetime":"2018-06-28","ticker":"VALE3","open":47.85,"close":49.07,"high":49.44,"low":47.5,"volume":792685313},{"datetime":"2018-06-29","ticker":"VALE3","open":49.7,"close":49.59,"high":50.1,"low":49.05,"volume":606754490},{"datetime":"2018-07-02","ticker":"VALE3","open":48.89,"close":48.76,"high":49.19,"low":48.52,"volume":401184228},{"datetime":"2018-07-03","ticker":"VALE3","open":49.3,"close":47.96,"high":49.49,"low":47.96,"volume":558650313},{"datetime":"2018-07-04","ticker":"VALE3","open":48.17,"close":48.03,"high":48.37,"low":47.6,"volume":294908066},{"datetime":"2018-07-05","ticker":"VALE3","open":48.55,"close":49.7,"high":49.77,"low":48.31,"volume":599649693},{"datetime":"2018-07-06","ticker":"VALE3","open":49.79,"close":50.34,"high":50.44,"low":49.39,"volume":430473635},{"datetime":"2018-07-10","ticker":"VALE3","open":50.7,"close":49.53,"high":51.1,"low":49.35,"volume":545295840},{"datetime":"2018-07-11","ticker":"VALE3","open":48.5,"close":48.86,"high":49.1,"low":48.45,"volume":629522394},{"datetime":"2018-07-12","ticker":"VALE3","open":49.35,"close":50.45,"high":50.67,"low":48.96,"volume":1038879636},{"datetime":"2018-07-13","ticker":"VALE3","open":50.6,"close":50.31,"high":50.89,"low":49.93,"volume":785317140},{"datetime":"2018-07-16","ticker":"VALE3","open":50.31,"close":50,"high":50.6,"low":49.6,"volume":627971125},{"datetime":"2018-07-17","ticker":"VALE3","open":50.13,"close":50.7,"high":51.02,"low":49.7,"volume":585327580},{"datetime":"2018-07-18","ticker":"VALE3","open":51.15,"close":51.45,"high":51.67,"low":50.82,"volume":500961160},{"datetime":"2018-07-19","ticker":"VALE3","open":50.71,"close":49.43,"high":50.75,"low":49.06,"volume":1041892404},{"datetime":"2018-07-20","ticker":"VALE3","open":49.59,"close":48.72,"high":49.86,"low":48.63,"volume":823910310},{"datetime":"2018-07-23","ticker":"VALE3","open":49.08,"close":49.6,"high":50.13,"low":48.53,"volume":422852493},{"datetime":"2018-07-24","ticker":"VALE3","open":51.92,"close":51.31,"high":52.39,"low":51.31,"volume":1082631439},{"datetime":"2018-07-25","ticker":"VALE3","open":51.46,"close":51.75,"high":51.75,"low":50.74,"volume":783387857},{"datetime":"2018-07-26","ticker":"VALE3","open":52.47,"close":52.78,"high":53.18,"low":52.4,"volume":2873852821},{"datetime":"2018-07-27","ticker":"VALE3","open":53.48,"close":53.45,"high":53.67,"low":53.25,"volume":1151652445},{"datetime":"2018-07-30","ticker":"VALE3","open":53.7,"close":54.33,"high":54.35,"low":53.56,"volume":838660298},{"datetime":"2018-07-31","ticker":"VALE3","open":54.2,"close":54.84,"high":54.98,"low":54.05,"volume":870319254},{"datetime":"2018-08-01","ticker":"VALE3","open":53.4,"close":53.06,"high":53.77,"low":53.02,"volume":1966466362},{"datetime":"2018-08-02","ticker":"VALE3","open":52.09,"close":52.84,"high":53.09,"low":51.5,"volume":1035431916},{"datetime":"2018-08-03","ticker":"VALE3","open":52.31,"close":52.55,"high":52.94,"low":51.33,"volume":819571657},{"datetime":"2018-08-06","ticker":"VALE3","open":52.1,"close":52.4,"high":52.91,"low":52,"volume":626207635},{"datetime":"2018-08-07","ticker":"VALE3","open":53.39,"close":52.75,"high":53.65,"low":52.63,"volume":1014452529},{"datetime":"2018-08-08","ticker":"VALE3","open":53.3,"close":52.4,"high":53.33,"low":52.26,"volume":690154259},{"datetime":"2018-08-09","ticker":"VALE3","open":52.5,"close":51.84,"high":53.04,"low":51.73,"volume":666009827},{"datetime":"2018-08-10","ticker":"VALE3","open":51.41,"close":51.71,"high":51.91,"low":50.72,"volume":750607445},{"datetime":"2018-08-13","ticker":"VALE3","open":52.07,"close":52.28,"high":52.69,"low":51.74,"volume":768898185},{"datetime":"2018-08-14","ticker":"VALE3","open":52.1,"close":52.76,"high":52.91,"low":51.77,"volume":915746006},{"datetime":"2018-08-15","ticker":"VALE3","open":51.6,"close":50.41,"high":51.98,"low":50.35,"volume":1356781798},{"datetime":"2018-08-16","ticker":"VALE3","open":50.9,"close":49.72,"high":51.03,"low":49.63,"volume":1009801446},{"datetime":"2018-08-17","ticker":"VALE3","open":49.53,"close":50.8,"high":51.19,"low":49.23,"volume":873786639},{"datetime":"2018-08-20","ticker":"VALE3","open":51.1,"close":51.44,"high":51.77,"low":51.04,"volume":760895269},{"datetime":"2018-08-21","ticker":"VALE3","open":51.16,"close":51.73,"high":52.1,"low":51.02,"volume":692364819},{"datetime":"2018-08-22","ticker":"VALE3","open":51.65,"close":53.3,"high":53.3,"low":51.63,"volume":689865887},{"datetime":"2018-08-23","ticker":"VALE3","open":53.1,"close":53.35,"high":53.52,"low":52.65,"volume":650822550},{"datetime":"2018-08-24","ticker":"VALE3","open":53.6,"close":54.15,"high":54.46,"low":53.55,"volume":593745941},{"datetime":"2018-08-27","ticker":"VALE3","open":54.17,"close":55.67,"high":55.67,"low":54.17,"volume":617634060},{"datetime":"2018-08-28","ticker":"VALE3","open":55.93,"close":55.65,"high":56.41,"low":55.07,"volume":995710633},{"datetime":"2018-08-29","ticker":"VALE3","open":55.25,"close":55.22,"high":56.16,"low":55.14,"volume":572045709},{"datetime":"2018-08-30","ticker":"VALE3","open":55.3,"close":54.57,"high":55.89,"low":54.4,"volume":796095083},{"datetime":"2018-08-31","ticker":"VALE3","open":54.52,"close":53.62,"high":54.8,"low":53.31,"volume":806689474},{"datetime":"2018-09-03","ticker":"VALE3","open":53.3,"close":54.05,"high":54.17,"low":53.21,"volume":235068736},{"datetime":"2018-09-04","ticker":"VALE3","open":53.6,"close":52,"high":53.79,"low":52,"volume":553773904},{"datetime":"2018-09-05","ticker":"VALE3","open":52.08,"close":52.15,"high":52.64,"low":51.75,"volume":370649139},{"datetime":"2018-09-06","ticker":"VALE3","open":52.79,"close":53.48,"high":53.87,"low":52.4,"volume":665801918},{"datetime":"2018-09-10","ticker":"VALE3","open":53.91,"close":53.22,"high":54.04,"low":52.96,"volume":499422685},{"datetime":"2018-09-11","ticker":"VALE3","open":52.61,"close":52.59,"high":52.99,"low":52.13,"volume":543680849},{"datetime":"2018-09-12","ticker":"VALE3","open":53,"close":53.45,"high":53.71,"low":52.18,"volume":754393833},{"datetime":"2018-09-13","ticker":"VALE3","open":53.7,"close":53.78,"high":54.43,"low":53.52,"volume":774619632},{"datetime":"2018-09-14","ticker":"VALE3","open":54.1,"close":55.2,"high":55.23,"low":54.05,"volume":933805050},{"datetime":"2018-09-17","ticker":"VALE3","open":55.3,"close":55.04,"high":55.57,"low":54.79,"volume":667499896},{"datetime":"2018-09-18","ticker":"VALE3","open":55.63,"close":57.34,"high":57.47,"low":55.51,"volume":1166958282},{"datetime":"2018-09-19","ticker":"VALE3","open":57.61,"close":58.58,"high":58.94,"low":57.53,"volume":728076247},{"datetime":"2018-09-20","ticker":"VALE3","open":59.21,"close":59.32,"high":59.61,"low":58.43,"volume":665113673},{"datetime":"2018-09-21","ticker":"VALE3","open":59.89,"close":61.01,"high":61.01,"low":59.6,"volume":1397105561},{"datetime":"2018-09-24","ticker":"VALE3","open":60.85,"close":60.2,"high":61.25,"low":60.15,"volume":545346542},{"datetime":"2018-09-25","ticker":"VALE3","open":60,"close":62.2,"high":62.22,"low":59.86,"volume":1035538070},{"datetime":"2018-09-26","ticker":"VALE3","open":62.2,"close":60.01,"high":62.42,"low":59.75,"volume":1494423124},{"datetime":"2018-09-27","ticker":"VALE3","open":60.22,"close":59.48,"high":60.75,"low":58.61,"volume":1224763718},{"datetime":"2018-09-28","ticker":"VALE3","open":58.85,"close":59.82,"high":60.29,"low":58.85,"volume":881140541},{"datetime":"2018-10-01","ticker":"VALE3","open":59.68,"close":60.4,"high":60.57,"low":59.08,"volume":537123678},{"datetime":"2018-10-02","ticker":"VALE3","open":60.87,"close":61.2,"high":61.74,"low":60.48,"volume":1256758449},{"datetime":"2018-10-03","ticker":"VALE3","open":62.01,"close":59.95,"high":62.19,"low":59.32,"volume":1618720433},{"datetime":"2018-10-04","ticker":"VALE3","open":59.99,"close":58.8,"high":60.34,"low":58.67,"volume":854190057},{"datetime":"2018-10-05","ticker":"VALE3","open":57.85,"close":57.49,"high":58.31,"low":57.23,"volume":1165330354},{"datetime":"2018-10-08","ticker":"VALE3","open":57,"close":57.05,"high":57.57,"low":55.26,"volume":1497734921},{"datetime":"2018-10-09","ticker":"VALE3","open":57.4,"close":57.66,"high":58.32,"low":56.72,"volume":1027429653},{"datetime":"2018-10-10","ticker":"VALE3","open":57.38,"close":55.89,"high":58.14,"low":55.89,"volume":802581939},{"datetime":"2018-10-11","ticker":"VALE3","open":56.44,"close":56.48,"high":57.16,"low":55.62,"volume":903782597},{"datetime":"2018-10-15","ticker":"VALE3","open":56.95,"close":57.67,"high":58.45,"low":56.84,"volume":940597719},{"datetime":"2018-10-16","ticker":"VALE3","open":57.94,"close":57.7,"high":58.85,"low":57.25,"volume":916892675},{"datetime":"2018-10-17","ticker":"VALE3","open":58.34,"close":58.8,"high":58.92,"low":57.75,"volume":1276411353},{"datetime":"2018-10-18","ticker":"VALE3","open":58.85,"close":56.5,"high":58.85,"low":56.32,"volume":985289548},{"datetime":"2018-10-19","ticker":"VALE3","open":57.1,"close":56.53,"high":57.53,"low":56.36,"volume":763372640},{"datetime":"2018-10-22","ticker":"VALE3","open":57.7,"close":58.37,"high":58.42,"low":57.03,"volume":815167688},{"datetime":"2018-10-23","ticker":"VALE3","open":57.31,"close":56.75,"high":57.55,"low":56,"volume":1175335377},{"datetime":"2018-10-24","ticker":"VALE3","open":57.4,"close":54.43,"high":57.59,"low":54.43,"volume":1003859041},{"datetime":"2018-10-25","ticker":"VALE3","open":55.97,"close":54.61,"high":56.04,"low":53.8,"volume":1614926322},{"datetime":"2018-10-26","ticker":"VALE3","open":54.9,"close":55.6,"high":55.89,"low":53.51,"volume":1457558161},{"datetime":"2018-10-29","ticker":"VALE3","open":56.5,"close":53.1,"high":56.5,"low":52.6,"volume":1418015974},{"datetime":"2018-10-30","ticker":"VALE3","open":53.6,"close":53.87,"high":54.85,"low":52.96,"volume":1285139081},{"datetime":"2018-10-31","ticker":"VALE3","open":54.35,"close":56.71,"high":56.71,"low":54.27,"volume":1491507507},{"datetime":"2018-11-01","ticker":"VALE3","open":56.75,"close":57.5,"high":58.26,"low":55.52,"volume":1169969749},{"datetime":"2018-11-05","ticker":"VALE3","open":57.61,"close":57.53,"high":58,"low":57.04,"volume":891378095},{"datetime":"2018-11-06","ticker":"VALE3","open":57,"close":57.23,"high":57.85,"low":56.56,"volume":644123081},{"datetime":"2018-11-07","ticker":"VALE3","open":57.79,"close":57.59,"high":58.15,"low":57.4,"volume":750009868},{"datetime":"2018-11-08","ticker":"VALE3","open":57.78,"close":57.02,"high":58.77,"low":57.02,"volume":970187523},{"datetime":"2018-11-09","ticker":"VALE3","open":56.5,"close":54.65,"high":57,"low":54.13,"volume":1616616496},{"datetime":"2018-11-12","ticker":"VALE3","open":55.1,"close":54.85,"high":55.45,"low":54.4,"volume":877744767},{"datetime":"2018-11-13","ticker":"VALE3","open":54.9,"close":56.27,"high":56.27,"low":54.35,"volume":1040026420},{"datetime":"2018-11-14","ticker":"VALE3","open":55.21,"close":55.16,"high":55.67,"low":54.25,"volume":1557232906},{"datetime":"2018-11-16","ticker":"VALE3","open":55.85,"close":56.15,"high":56.35,"low":55.15,"volume":1095643588},{"datetime":"2018-11-19","ticker":"VALE3","open":56.15,"close":55.37,"high":56.28,"low":54.81,"volume":719162448},{"datetime":"2018-11-21","ticker":"VALE3","open":54.15,"close":54.53,"high":54.55,"low":53.71,"volume":1007794112},{"datetime":"2018-11-22","ticker":"VALE3","open":54.69,"close":54.04,"high":54.72,"low":53.75,"volume":500332111},{"datetime":"2018-11-23","ticker":"VALE3","open":53.39,"close":50.35,"high":53.39,"low":50.35,"volume":1718233694},{"datetime":"2018-11-26","ticker":"VALE3","open":49.95,"close":50.12,"high":51.09,"low":49,"volume":1517353779},{"datetime":"2018-11-27","ticker":"VALE3","open":49.69,"close":49.92,"high":50.49,"low":49.1,"volume":1273834166},{"datetime":"2018-11-28","ticker":"VALE3","open":50.5,"close":52.3,"high":52.32,"low":50.22,"volume":1497792983},{"datetime":"2018-11-29","ticker":"VALE3","open":51.92,"close":52,"high":52.73,"low":51.13,"volume":1214866826},{"datetime":"2018-11-30","ticker":"VALE3","open":51.56,"close":52.8,"high":53.69,"low":51.56,"volume":1558424964},{"datetime":"2018-12-03","ticker":"VALE3","open":55.6,"close":54.11,"high":55.68,"low":53.74,"volume":1769910366},{"datetime":"2018-12-04","ticker":"VALE3","open":54.35,"close":52.88,"high":54.52,"low":52.5,"volume":1438900836},{"datetime":"2018-12-05","ticker":"VALE3","open":53.3,"close":52.8,"high":53.48,"low":52.43,"volume":511029656},{"datetime":"2018-12-06","ticker":"VALE3","open":51.7,"close":52.3,"high":52.6,"low":51.07,"volume":1107907007},{"datetime":"2018-12-07","ticker":"VALE3","open":52.48,"close":51.29,"high":53.26,"low":51.09,"volume":1015598751},{"datetime":"2018-12-10","ticker":"VALE3","open":51.12,"close":50.2,"high":51.64,"low":50.19,"volume":726571640},{"datetime":"2018-12-11","ticker":"VALE3","open":51.15,"close":50.6,"high":51.74,"low":50.25,"volume":990439784},{"datetime":"2018-12-12","ticker":"VALE3","open":51.15,"close":50.37,"high":51.4,"low":50.35,"volume":804996158},{"datetime":"2018-12-13","ticker":"VALE3","open":50.85,"close":50.6,"high":51.28,"low":50.25,"volume":768703133},{"datetime":"2018-12-14","ticker":"VALE3","open":50.38,"close":50.88,"high":51.19,"low":49.85,"volume":858323605},{"datetime":"2018-12-17","ticker":"VALE3","open":51.9,"close":51.25,"high":52.27,"low":51.03,"volume":1104420898},{"datetime":"2018-12-18","ticker":"VALE3","open":51.35,"close":51.44,"high":52.19,"low":51.35,"volume":983185918},{"datetime":"2018-12-19","ticker":"VALE3","open":51.8,"close":50.01,"high":52.4,"low":50.01,"volume":1262213308},{"datetime":"2018-12-20","ticker":"VALE3","open":50.74,"close":49.81,"high":51.17,"low":49.45,"volume":1277518438},{"datetime":"2018-12-21","ticker":"VALE3","open":50.28,"close":50.86,"high":51.25,"low":50.22,"volume":1437350581},{"datetime":"2018-12-26","ticker":"VALE3","open":50.11,"close":50.44,"high":50.7,"low":49.4,"volume":669735755},{"datetime":"2018-12-27","ticker":"VALE3","open":50.1,"close":49.5,"high":50.39,"low":49.28,"volume":714974681},{"datetime":"2018-12-28","ticker":"VALE3","open":50.31,"close":51,"high":51.2,"low":50.25,"volume":604233637}]
console.log('handleByTicker',tickerHistory)
function setup() {
	console.log('setup')
	let canvas = createCanvas(windowWidth * 0.95, windowHeight * 0.95);
	frameRate(60);
	rectMode(CENTER);
	textSize(18)
	fill(255);

	// Initialize Generation
	generation.initialize(Trader);
	// generation.species.forEach((creature) => { creature.add_to_world(world) });

	// Boundary
	boundary = new SimpleBoundary();
	boundary.add_to_world();

	// Mouse Constraint
	let canvasMouse = Matter.Mouse.create(canvas.elt);
	canvasMouse.pixelRatio = pixelDensity();
	let m = Matter.MouseConstraint.create(engine, { mouse: canvasMouse });
	// Matter.World.add(world, m);

	// Restart Generation after 5 seconds
	// setInterval(() => {
	// 	generation.evolve();
	// 	console.log(generation.avg_score);
	// 	settled = false;
	// }, generationPeriod * 1000);
}

let frame = 1

let counter = 1;
const mvperiodsa = 7
const mvperiodsb = 21
let mvavga = []
let mvavgb = []
function draw() {
	try {
		counter++;
		let i = counter / frame
		if (counter % frame != 0 ) {
			return 
		}
		if (counter > 198 * frame) {
			counter = 0;
			settled = true;
			generation.evolve();
			// generation.generation > 30 ? frame = 40  : frame = frame
		}
		background(color(15, 15, 19));

		// Display Boundary
		const currentValue = tickerHistory[i]
		let currMvValueA =  currentValue.close
		let currMvValueB =  currentValue.close
		if (i > mvperiodsa) {
			const lastn = tickerHistory.slice(i-mvperiodsa, i);
			const sum = lastn.reduce((a, b) => a + b.close, 0) 
			currMvValueA = (sum/ mvperiodsa);
			mvavga[i] = currMvValueA;
		} 
		if (i > mvperiodsb) {
			const lastn = tickerHistory.slice(i-mvperiodsb, i);
			const sum = lastn.reduce((a, b) => a + b.close, 0) 
			currMvValueB = (sum/ mvperiodsb);
			mvavgb[i] = currMvValueB;
		} 
		boundary.display(tickerHistory,i,mvavga,mvavgb);

		// Display Creatures
		

		generation.species.forEach((creature) => {
			// if (i % 4 === 0) {
				creature.think(i,currentValue,currMvValueA,currMvValueB);
			// }
			creature.show(i,currentValue);
			creature.adjust_score();
		});

		// Display Stats
		textSize(18)
		fill("red");

		text("Generation: " + generation.generation, 40, 50);
		text("HighScore: " + generation.high_score.toFixed(2), 40, 70);
		text("Average Score " + generation.avg_score.toFixed(2), 40, 90);
		text("Population: " + generation.population, 40, 110);
		text("Mutation Rate: " + 5 + "%", 40, 130);
		text("Counter: " + i, 40, 150);
		text("Date: " + currentValue.datetime, 40, 170);
		text("Frame rate: " + frame, 40, 190);
		text("Moving Avg periods: " + mvperiodsa, 40, 210);
		text("Close: " + currentValue.close, 40, 230);
		text("MavgA value: " + currMvValueA.toFixed(2), 40, 250);
		text("MavgB value: " + currMvValueB.toFixed(2), 40, 270);
		// Display Inheritance
		textSize(14);
		fill('green');
		text("id\t\tBRLPCT\t\FOO\t\tSCORE", width * 0.78, 40)
		generation.species.forEach((creature, index) => {
			let txt = `${creature.id} \t\t\t ${(creature.balanceBRL/creature.initialBalance*100).toFixed(0)} \t\t\t bar \t\t\t (${creature.tradeCount}) ${creature.score}`

			// if (creature.parents.length !== 0)
			// 	txt = `${creature.id} \t\t\t ${creature.parents[0].id} (${creature.parents[0].score.toFixed(0)}) \t\t\t ${creature.parents[1].id}(${creature.parents[1].score.toFixed(0)})`;
			// else
			// 	txt = `${creature.id} \t\t\t ------ \t\t\t ------`
			text(txt, width * 0.80, 60 + (15 * index));
		})

		// Run Matter-JS Engine
		Matter.Engine.update(engine);
	} catch (e) {
		console.log(e)
	}
}